alter table public.cards enable row level security;

create policy "Allow public read"
on public.cards
for select
to public
using (true);
create policy "Allow insert for authenticated users"
on public.cards
for insert
to authenticated
with check (auth.uid() = user_id);
create policy "Allow update for owner"
on public.cards
for update
to authenticated
using (auth.uid() = user_id)
with check (auth.uid() = user_id);
create policy "Allow delete for owner"
on public.cards
for delete
to authenticated
using (auth.uid() = user_id);


create policy "Allow upload for authenticated users"
on storage.objects
for insert
to authenticated
with check (
  bucket_id = 'card_photos'
);
create policy "Allow update for owner"
on storage.objects
for update
to authenticated
using (
  bucket_id = 'card_photos'
  and auth.uid()::text = (storage.foldername(name))[1]
);
create policy "allow public read"
on storage.objects
for select
to public
using (bucket_id = 'card_photos');

-- 開発用：更新後のチェックを緩める
create policy "Allow owner update safely2"
on public.cards
for update
to authenticated
using (auth.uid() = user_id)
with check (true);
